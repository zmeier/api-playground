function findLocation(a){document.getElementById("map-error-banner").innerHTML="",navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){pos={lat:b.coords.latitude,lng:b.coords.longitude},a&&a(pos)},function(){handleLocationError("The Geolocation service failed. Make sure to allow location access.")}):handleLocationError("Error: Your browser doesn't support geolocation.")}function initialLoad(){updateNews(),pos?updateWeatherInfo(pos):findLocation(updateWeatherInfo)}function initMap(){if(document.getElementById("map-error-banner").innerHTML="",pos){var a=createMap(pos,{zoom:14});addAreaPlaces(a)}else findLocation(function(a){var b=createMap(a,{zoom:14});addAreaPlaces(b)})}function handleLocationError(a){updateWeatherInfo(defaultPos);var b=document.getElementById("map-error-banner");b.innerHTML="<p>"+a+"</p>";var c=createMap();addAreaPlaces(c)}function createMap(a,b){a||(a=defaultPos),b||(b={}),b.zoom=b.zoom?b.zoom:16;var d=new google.maps.Map(document.getElementById("map"),{center:a,zoom:b.zoom,mapTypeControl:!1});return d.addListener("center_changed",function(){clearTimeout(mapupdater),mapupdater=setTimeout(function(){addAreaPlaces(d)},500)}),d.addListener("click",function(){openInfoWindow&&(openInfoWindow.close(),openInfoWindow=null)}),d}function addAreaPlaces(a){if(""!==FOURSQUARE_CLIENT_ID&&""!==FOURSQUARE_CLIENT_SECRET&&a){var b=a.getCenter();if(b){var c="https://api.foursquare.com/v2/venues/explore?client_id="+FOURSQUARE_CLIENT_ID+"&client_secret="+FOURSQUARE_CLIENT_SECRET+"&v=20161001&ll="+b.lat()+","+b.lng();$.getJSON(c,function(b){parseExploreData(a,b)}).error(function(){})}}}function parseExploreData(a,b){var c,d;if(b.response&&b.response.groups[0]){c=b.response.groups[0].items;new google.maps.InfoWindow;for(d=0;d<c.length;d++)addMarker(a,c[d].venue,c[d].tips)}}function addMarker(a,b,c){var d=b.name,e={lat:b.location.lat,lng:b.location.lng},f=new google.maps.Marker({position:e,map:a,title:d});attachInfoWindow(f,{name:d,tips:c})}function attachInfoWindow(a,b){var c="<div class='info-title'>"+b.name+"</div>";if(b.tips)for(var d=0;d<4&&d<b.tips.length;d++){var e=b.tips[d];e&&(c+="<p>"+e.text,e.user&&(c+="<br/>- "+e.user.firstName),c+="</p>")}var f=new google.maps.InfoWindow({content:c,maxWidth:200});a.addListener("click",function(){openInfoWindow&&(openInfoWindow.close(),openInfoWindow=null),f.open(a.get("map"),a),openInfoWindow=f})}function updateWeatherInfo(a){if(""!==OPENWEATHERMAP_API_KEY){var b="http://api.openweathermap.org/data/2.5/weather?lat="+a.lat+"&lon="+a.lng+"&units=imperial&appid="+OPENWEATHERMAP_API_KEY;$.getJSON(b,function(a){parseWeatherData(a)}).error(function(){})}}function parseWeatherData(a){if(a&&a.main){document.getElementById("currenttemp").innerHTML=parseInt(tempConverter(a.main.temp,"F","F"))+"째F",a.weather[0]?document.getElementById("currenttempimg").innerHTML="<img src='http://openweathermap.org/img/w/"+a.weather[0].icon+".png' alt='"+a.weather[0].main+"' />":document.getElementById("currenttempimg").innerHTML="";var b=parseInt(tempConverter(a.main.temp_max,"F","F")),c=parseInt(tempConverter(a.main.temp_min,"F","F"));b===c?document.getElementById("temprange").innerHTML="-- / "+c+"째F":document.getElementById("temprange").innerHTML=b+"째F / "+c+"째F",document.getElementById("humidity").innerHTML=a.main.humidity+"%",document.getElementById("wind").innerHTML=a.wind.speed+"mph",$("#weathertable").removeClass("nodisp")}}function tempConverter(a,b,c){var d=String(b)+String(c);switch(d){case"KF":return 1.8*a-459.67;case"KC":return a-273.15;case"CK":return a+273.15;case"CF":return 1.8*a+32;case"FK":return(a+459.67)*(5/9);case"FC":return(a-32)*(5/9);default:return a}}function updateNews(){""!==BINGNEWSSEARCH_API_KEY&&$(function(){var a={q:"local news",count:"10",offset:"0",mkt:"en-us",safeSearch:"Moderate"};$.ajax({url:"https://api.cognitive.microsoft.com/bing/v5.0/news/search?"+$.param(a),beforeSend:function(a){a.setRequestHeader("Ocp-Apim-Subscription-Key",BINGNEWSSEARCH_API_KEY)},type:"GET"}).done(function(a){parseNewsData(a)}).fail(function(){alert("error")})})}function parseNewsData(a){newsItems=a.value;for(var b=document.getElementById("newslist"),c="",d=0;d<newsItems.length;d++){var e=newsItems[d];c+="<li>"+formatNewsArticle(e)+"</li>"}b.innerHTML=c}function formatNewsArticle(a){var b;a.image&&a.image&&(b=a.image.thumbnail);var c="<div class='newsheader'><a href='"+a.url+"'><b>"+a.name+"</b></a></div>";c+="<div class='newsdescription'>"+a.description+"</div>";var d="<table class='newstable'><tr>";return b?(d+="<td><img src='"+b.contentUrl+"' /></td>",d+="<td>"+c+"</td>"):d+="<td colspan=2>"+c+"</td>",d+="</tr></table>"}function show(){getAPIKeys(),initialLoad(),$("#setup").addClass("nodisp"),$("#mapheader").removeClass("nodisp"),$("#main").removeClass("nodisp")}function getAPIKeys(){FOURSQUARE_CLIENT_ID=$("#foursquareAPIkey").val(),FOURSQUARE_CLIENT_SECRET=$("#foursquareAPIsecret").val(),OPENWEATHERMAP_API_KEY=$("#openweatherAPIkey").val(),BINGNEWSSEARCH_API_KEY=$("#bingsearchAPIkey").val()}var FOURSQUARE_CLIENT_ID="",FOURSQUARE_CLIENT_SECRET="",OPENWEATHERMAP_API_KEY="",BINGNEWSSEARCH_API_KEY="",openInfoWindow=null,mapupdater=null,city="",defaultPos={lat:43.0747,lng:-89.3843},pos=null;